<html>
  <head>
    <title>Connect to Metamask Wallet</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css">
  </head>

  <body>
    <div>
      <div>
        <h1>Click to connect your wallet</h1>
        <button id="connectWallet" >
          <img src="img/MetaMask_Fox.png" />
          Connect Wallet
        </button>
        <div id="my_wallet"></div>
      </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/web3/1.8.0/web3.min.js" integrity="sha512-bSQ2kf76XufUYS/4XinoHLp5S4lNOyRv0/x5UJACiOMy8ueqTNwRFfUZWmWpwnczjRp9SjiF1jrXbGEim7Y0Xg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="chainNetwork.js"></script>
    <script>
      function loadWallet(){
        document.querySelector( 'button' ).style.display = "none";
        document.querySelector( '#my_wallet' ).innerHTML = '<div class="loader"></div>';
        setTimeout( connectWallet, 1000 );
      }

      async function connectWallet() {
        if ( typeof window.ethereum != 'undefined' ) {
          await window.ethereum.request({ 
            method: "eth_requestAccounts" 
          });
          window.web3 = new Web3( window.ethereum );
          const account = web3.eth.accounts;
          const walletAddress = account.givenProvider.selectedAddress;
          const chainID = window.ethereum.networkVersion;
          document.querySelector( 'h1' ).innerHTML = '<span class="success"><i class="fa fa-check-circle"></i>Connected!</span>';
          document.querySelector( '#my_wallet' ).innerHTML = walletAddress + getNetwork( chainID );
        } else {
          document.querySelector( 'h1' ).innerHTML = '<img src="img/MetaMask_Fox.png" /> Metamask wallet not installed';
          document.querySelector( '#my_wallet' ).innerHTML = '<p>Refer <a target="_blank" class="link" href="https://metamask.io/download/">here<a/> to download</p>';
        }
      }

      document.getElementById( "connectWallet" ).addEventListener( "click", loadWallet );
    	ethereum.on('chainChanged', ( _chainId ) => loadWallet() );

    </script>
  </body>
</html>
